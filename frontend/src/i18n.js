import React, { createContext, useCallback, useContext, useMemo, useState } from 'react';

export const SUPPORTED_LANGUAGES = [
  { code: 'ru', label: 'RU' },
  { code: 'en', label: 'EN' },
  { code: 'kk', label: 'KZ' },
];

const translations = {
  ru: {
    'app.title': 'HOG MAPS',
    'common.request_failed': 'Ошибка запроса',
    'common.user': 'пользователь',
    'common.unknown': 'неизвестно',

    'auth.skip_auth': 'Пропустить вход',
    'auth.create_account': 'Создать аккаунт',
    'auth.sign_in': 'Войти',
    'auth.subtitle': '',
    'auth.nickname': 'Никнейм',
    'auth.email': 'Почта',
    'auth.password': 'Пароль',
    'auth.confirm_password': 'Повтор пароля',
    'auth.login': 'Логин',
    'auth.placeholder.nickname': 'ваше имя',
    'auth.placeholder.email': 'mail@example.com',
    'auth.placeholder.password': 'Минимум 8 символов',
    'auth.placeholder.confirm_password': 'Повторите пароль',
    'auth.placeholder.login': 'никнейм или почта',
    'auth.placeholder.password_login': 'Ваш пароль',
    'auth.passwords_do_not_match': 'Пароли не совпадают',
    'auth.guest_mode_enabled':
      'Гостевой режим включён. Эндпоинты с авторизацией могут быть недоступны.',
    'auth.user_created': 'Пользователь {username} создан. Войдите в аккаунт.',
    'auth.token_missing': 'Токен не вернулся с бэка',
    'auth.welcome': 'Привет, {username}!',
    'auth.please_wait': 'Подождите...',
    'auth.sign_up_button': 'Зарегистрироваться',
    'auth.sign_in_button': 'Войти',
    'auth.already_have_account': 'Уже есть аккаунт? ',
    'auth.no_account_yet': 'Нет аккаунта? ',
    'auth.create_one_link': 'Создать',

    'map.control_center': 'Центр управления',
    'map.refresh_changes': 'Обновить',
    'map.logout': 'Выйти',
    'map.mapbox_token': 'Токен Mapbox',
    'map.active': 'активен',
    'map.missing': 'нет',
    'map.congestion': 'Загруженность',
    'map.hide_graph': 'Скрыть график',
    'map.show_graph': 'Показать график',
    'map.start_label': 'Старт',
    'map.destination_label': 'Финиш',
    'map.tap_map_a': 'тапни по карте (A)',
    'map.tap_map_b': 'тапни по карте (B)',
    'map.destination_set': 'задан',
    'map.manual': 'вручную',
    'map.use_my_location': 'Моё место',
    'map.reset_ab': 'Сбросить A/B',
    'map.route_info': 'Маршрут: {km} км · {min} мин',
    'map.mode_label': 'Режим',
    'map.route_mode_title': 'Рекомендуемый тип маршрута',
    'map.mode.driving': 'Авто',
    'map.mode.walking': 'Пешком',
    'map.mode.cycling': 'Велосипед',
    'map.min_short': 'м',
    'map.build_mode_on': 'Конструктор: вкл',
    'map.build_mode_off': 'Конструктор: выкл',
    'map.build_type': 'Тип здания',
    'map.undo_building': 'Отменить объект',
    'map.clear_buildings': 'Очистить объекты',
    'map.building.residential': 'Жилой дом',
    'map.building.office': 'Офис',
    'map.building.school': 'Школа',
    'map.building.hospital': 'Больница',
    'map.building.park': 'Парк',
    'map.buildings_count': 'Объектов на карте: {count}',
    'map.buildings_impact':
      'Влияние: поток {flow}, объезд {detour}%, экология {ecology}, соц. индекс {social}',
    'map.terrain_on': 'Рельеф: вкл',
    'map.terrain_off': 'Рельеф: выкл',
    'map.heatmap_on': 'Heatmap: вкл',
    'map.heatmap_off': 'Heatmap: выкл',
    'map.draw_start': 'Рисовать зону',
    'map.draw_stop': 'Выход из рисования',
    'map.isochrone_10m': 'Изохрона 10 мин',
    'map.loading_isochrone': 'Строю изохрону...',
    'map.clear_isochrones': 'Очистить изохроны',
    'map.polygon_area': 'Площадь зоны',
    'map.polygon_population': 'Оценка населения',
    'map.polygon_households': 'Домохозяйства',
    'map.polygon_schools': 'Школ (оценка)',
    'map.theme.dark': 'Тёмная карта',
    'map.theme.light': 'Светлая карта',
    'map.legend_green': 'Зелёный: свободно',
    'map.legend_yellow': 'Жёлтый: средняя загрузка',
    'map.legend_red': 'Красный: пробка',
    'map.section.change_graph': 'График изменений',
    'map.metric.traffic': 'Трафик',
    'map.metric.ecology': 'Экология',
    'map.metric.social': 'Соц.',
    'map.flow': 'Поток',
    'map.vehicles_per_hour': 'авто/ч',
    'map.detour': 'Объезд',
    'map.system_status': 'Статус системы',
    'map.point.me_a': 'Я (A)',
    'map.point.start_a': 'Старт (A)',
    'map.point.destination_b': 'Финиш (B)',
    'map.point.building': 'Объект: {type}',

    'map.status.waiting_transport': 'Ожидаю обновление транспорта',
    'map.status.change_graph_updated': 'Данные обновлены',
    'map.status.transport_update_failed': 'Не удалось обновить данные транспорта',
    'map.status.tap_to_set_a': 'Тапни по карте, чтобы поставить старт (A)',
    'map.status.start_set_tap_b': 'Старт (A) задан. Тапни финиш (B) на карте.',
    'map.status.gps_a_set_tap_b': 'GPS-старт (A) задан. Тапни финиш (B) на карте.',
    'map.status.location_denied':
      'Доступ к геолокации запрещён. Тапни по карте, чтобы поставить старт (A).',
    'map.status.location_read_failed':
      'Не удалось определить геолокацию. Тапни по карте, чтобы поставить старт (A).',
    'map.status.location_lookup_failed':
      'Ошибка геолокации. Тапни по карте, чтобы поставить старт (A).',
    'map.status.route_ready': 'Маршрут готов',
    'map.status.route_ready_summary': 'Маршрут готов: {summary}',
    'map.status.route_build_failed': 'Не удалось построить маршрут',
    'map.status.selecting_modes': 'Сравниваю типы маршрутов по трафику...',
    'map.status.recommended_mode': 'Рекомендован режим: {mode}.',
    'map.status.mode_pick_failed': 'Не удалось подобрать типы маршрутов.',
    'map.status.new_start_set': 'Новая точка A выбрана. Тапни точку B.',
    'map.status.build_mode_on': 'Режим конструктора включён. Тап по карте добавляет здания.',
    'map.status.build_mode_off': 'Режим конструктора выключен.',
    'map.status.building_added': 'Добавлен объект: {type}.',
    'map.status.building_removed': 'Последний объект удалён.',
    'map.status.buildings_cleared': 'Все добавленные объекты удалены.',
    'map.status.drawing_mode_active': 'Режим рисования активен. Завершите полигон или выключите режим.',
    'map.status.set_point_for_isochrone': 'Сначала выберите точку на карте для изохроны.',
    'map.status.isochrone_ready': 'Изохрона построена.',
    'map.status.isochrone_failed': 'Не удалось построить изохрону.',
    'map.status.isochrone_cleared': 'Изохроны очищены.',
    'map.status.polygon_drawn': 'Полигон нарисован, площадь: {area} км².',
    'map.status.polygon_insights_ready': 'Аналитика зоны готова. Население: ~{population}.',
    'map.status.polygon_cleared': 'Нарисованные зоны очищены.',

    'ai.agent': 'AI Агент',
    'ai.welcome':
      'Я AI-агент цифрового двойника. Спроси, например: "Как изменится трафик в ближайшие часы?"',
    'ai.placeholder': 'Например: что изменится в трафике при перекрытии моста?',
    'ai.thinking': 'Думаю...',
    'ai.send': 'Отправить',
    'ai.close': 'Закрыть',

    'ai.fallback.bridge':
      'Прогноз: поток {flow} авто/ч, рост на объездах около {detour}%. Риски: локальные заторы и задержка доставок. Действия: реверсивное движение, ручная настройка светофоров, ограничение грузовиков в пик.',
    'ai.fallback.traffic':
      'Прогноз: текущая транспортная нагрузка близка к {moving}%. Риски: рост времени в пути на перегруженных узлах. Действия: перераспределить рейсы вне пика, увеличить приоритет ОТ, корректировать циклы светофоров.',
    'ai.fallback.ecology':
      'Прогноз: индекс экологии около {ecology}. Риски: локальное ухудшение качества воздуха в загруженных районах. Действия: ограничить транзит через жилые кварталы и перераспределить потоки.',
    'ai.fallback.default':
      'Могу оценить изменения трафика, экологии и логистики по текущим данным. Уточни объект/район и временной горизонт.',
    'ai.fallback.buildings':
      'В проекте уже {count} новых объектов. Эффект: поток {flow}, изменение экологии {ecology}. Уточни типы застройки и радиус, чтобы точнее рассчитать влияние.',
    'ai.polygon_summary':
      'Анализ зоны: площадь {area} км², население около {population}, рекомендовано школ: {schools}.',

    'map3d.traffic_ready': 'Слой трафика Mapbox включён (зелёный/жёлтый/оранжевый/красный).',
    'map3d.traffic_score': 'Оценка трафика Mapbox: {score}/10.',
    'map3d.mapbox_ready': 'Карта Mapbox подключена.',
    'map3d.terrain_ready': '3D-рельеф Mapbox включён.',
    'map3d.isochrone_ready': 'Изохроны отображены на карте.',
    'map3d.draw_mode_on': 'Режим рисования включён.',
    'map3d.draw_mode_off': 'Режим рисования выключен.',
    'map3d.draw_complete': 'Полигон построен.',
    'map3d.draw_cleared': 'Полигон удалён.',
    'map3d.fallback_ready': 'Включена запасная карта (MapLibre).',
  },
  en: {
    'app.title': 'HOG MAPS',
    'common.request_failed': 'Request failed',
    'common.user': 'user',
    'common.unknown': 'unknown',

    'auth.skip_auth': 'Skip auth',
    'auth.create_account': 'Create account',
    'auth.sign_in': 'Sign in',
    'auth.subtitle': '',
    'auth.nickname': 'Nickname',
    'auth.email': 'Email',
    'auth.password': 'Password',
    'auth.confirm_password': 'Confirm password',
    'auth.login': 'Login',
    'auth.placeholder.nickname': 'your name',
    'auth.placeholder.email': 'yourmail@example.com',
    'auth.placeholder.password': 'At least 8 characters',
    'auth.placeholder.confirm_password': 'Repeat password',
    'auth.placeholder.login': 'username or email',
    'auth.placeholder.password_login': 'Your password',
    'auth.passwords_do_not_match': 'Passwords do not match',
    'auth.guest_mode_enabled': 'Guest mode enabled. Auth-only endpoints may be unavailable.',
    'auth.user_created': 'User {username} created. Please sign in.',
    'auth.token_missing': 'Token was not returned by backend',
    'auth.welcome': 'Welcome, {username}',
    'auth.please_wait': 'Please wait...',
    'auth.sign_up_button': 'Sign up',
    'auth.sign_in_button': 'Sign in',
    'auth.already_have_account': 'Already have an account? ',
    'auth.no_account_yet': 'No account yet? ',
    'auth.create_one_link': 'Create one',

    'map.control_center': 'Control center',
    'map.refresh_changes': 'Refresh changes',
    'map.logout': 'Logout',
    'map.mapbox_token': 'Mapbox token',
    'map.active': 'active',
    'map.missing': 'missing',
    'map.congestion': 'Congestion',
    'map.hide_graph': 'Hide graph',
    'map.show_graph': 'Show graph',
    'map.start_label': 'Start',
    'map.destination_label': 'Destination',
    'map.tap_map_a': 'tap map (A)',
    'map.tap_map_b': 'tap map (B)',
    'map.destination_set': 'set',
    'map.manual': 'manual',
    'map.use_my_location': 'Use my location',
    'map.reset_ab': 'Reset A/B',
    'map.route_info': 'Route: {km} km · {min} min',
    'map.mode_label': 'Mode',
    'map.route_mode_title': 'Recommended route type',
    'map.mode.driving': 'Car',
    'map.mode.walking': 'Walk',
    'map.mode.cycling': 'Bike',
    'map.min_short': 'm',
    'map.build_mode_on': 'Builder: on',
    'map.build_mode_off': 'Builder: off',
    'map.build_type': 'Building type',
    'map.undo_building': 'Undo object',
    'map.clear_buildings': 'Clear objects',
    'map.building.residential': 'Residential',
    'map.building.office': 'Office',
    'map.building.school': 'School',
    'map.building.hospital': 'Hospital',
    'map.building.park': 'Park',
    'map.buildings_count': 'Objects on map: {count}',
    'map.buildings_impact':
      'Impact: flow {flow}, detour {detour}%, ecology {ecology}, social score {social}',
    'map.terrain_on': 'Terrain: on',
    'map.terrain_off': 'Terrain: off',
    'map.heatmap_on': 'Heatmap: on',
    'map.heatmap_off': 'Heatmap: off',
    'map.draw_start': 'Draw area',
    'map.draw_stop': 'Stop drawing',
    'map.isochrone_10m': 'Isochrone 10 min',
    'map.loading_isochrone': 'Building isochrone...',
    'map.clear_isochrones': 'Clear isochrones',
    'map.polygon_area': 'Area',
    'map.polygon_population': 'Population estimate',
    'map.polygon_households': 'Households',
    'map.polygon_schools': 'Schools (estimate)',
    'map.theme.dark': 'Dark map',
    'map.theme.light': 'Light map',
    'map.legend_green': 'Green: free',
    'map.legend_yellow': 'Yellow: medium load',
    'map.legend_red': 'Red: traffic jam',
    'map.section.change_graph': 'Change graph',
    'map.metric.traffic': 'Traffic',
    'map.metric.ecology': 'Ecology',
    'map.metric.social': 'Social',
    'map.flow': 'Flow',
    'map.vehicles_per_hour': 'veh/h',
    'map.detour': 'Detour',
    'map.system_status': 'System status',
    'map.point.me_a': 'Me (A)',
    'map.point.start_a': 'Start (A)',
    'map.point.destination_b': 'Destination (B)',
    'map.point.building': 'Object: {type}',

    'map.status.waiting_transport': 'Waiting for transport update',
    'map.status.change_graph_updated': 'Change graph updated',
    'map.status.transport_update_failed': 'Transport update failed',
    'map.status.tap_to_set_a': 'Tap map to set start point (A)',
    'map.status.start_set_tap_b': 'Start point (A) is set. Tap destination (B) on map.',
    'map.status.gps_a_set_tap_b': 'GPS start point (A) is set. Tap destination (B) on map.',
    'map.status.location_denied': 'Location permission denied. Tap map to set start point (A).',
    'map.status.location_read_failed': 'Failed to read GPS position. Tap map to set start point (A).',
    'map.status.location_lookup_failed': 'Location lookup failed. Tap map to set start point (A).',
    'map.status.route_ready': 'Route ready',
    'map.status.route_ready_summary': 'Route ready: {summary}',
    'map.status.route_build_failed': 'Route build failed',
    'map.status.selecting_modes': 'Comparing route modes with current traffic...',
    'map.status.recommended_mode': 'Recommended mode: {mode}.',
    'map.status.mode_pick_failed': 'Failed to pick route modes.',
    'map.status.new_start_set': 'New point A is set. Tap point B.',
    'map.status.build_mode_on': 'Building mode enabled. Tap map to place buildings.',
    'map.status.build_mode_off': 'Building mode disabled.',
    'map.status.building_added': 'Added object: {type}.',
    'map.status.building_removed': 'Last object removed.',
    'map.status.buildings_cleared': 'All added objects removed.',
    'map.status.drawing_mode_active': 'Drawing mode is active. Finish polygon or disable this mode.',
    'map.status.set_point_for_isochrone': 'Pick a point on the map before requesting isochrones.',
    'map.status.isochrone_ready': 'Isochrone is ready.',
    'map.status.isochrone_failed': 'Isochrone build failed.',
    'map.status.isochrone_cleared': 'Isochrones cleared.',
    'map.status.polygon_drawn': 'Polygon drawn. Area: {area} km².',
    'map.status.polygon_insights_ready': 'Zone analytics ready. Population: ~{population}.',
    'map.status.polygon_cleared': 'Drawn polygons cleared.',

    'ai.agent': 'AI Agent',
    'ai.welcome':
      "I'm an AI agent of the city's digital twin. Ask, for example: \"How will traffic change in the next hours?\"",
    'ai.placeholder': 'For example: what happens to traffic if the bridge is closed?',
    'ai.thinking': 'Thinking...',
    'ai.send': 'Send',
    'ai.close': 'Close',

    'ai.fallback.bridge':
      'Forecast: flow {flow} veh/h, detours up ~{detour}%. Risks: local jams and delivery delays. Actions: reversible lanes, manual traffic light tuning, restrict trucks at peak.',
    'ai.fallback.traffic':
      'Forecast: current traffic load is about {moving}%. Risks: longer travel times on key junctions. Actions: shift trips off-peak, increase public transport priority, adjust signal cycles.',
    'ai.fallback.ecology':
      'Forecast: ecology index is around {ecology}. Risks: local air quality degradation in busy areas. Actions: restrict transit through residential blocks and rebalance flows.',
    'ai.fallback.default':
      'I can estimate traffic, ecology and logistics changes from current data. Specify the object/area and time horizon.',
    'ai.fallback.buildings':
      'There are already {count} new objects in the project. Impact: flow {flow}, ecology shift {ecology}. Specify building mix and radius for better estimates.',
    'ai.polygon_summary':
      'Zone analysis: area {area} km², population around {population}, recommended schools: {schools}.',

    'map3d.traffic_ready': 'Mapbox traffic layer enabled (green/yellow/orange/red).',
    'map3d.traffic_score': 'Mapbox traffic score: {score}/10.',
    'map3d.mapbox_ready': 'Mapbox map is ready.',
    'map3d.terrain_ready': 'Mapbox 3D terrain enabled.',
    'map3d.isochrone_ready': 'Isochrones are shown on the map.',
    'map3d.draw_mode_on': 'Drawing mode enabled.',
    'map3d.draw_mode_off': 'Drawing mode disabled.',
    'map3d.draw_complete': 'Polygon completed.',
    'map3d.draw_cleared': 'Polygon cleared.',
    'map3d.fallback_ready': 'Fallback map active (MapLibre).',
  },
  kk: {
    'app.title': 'HOG MAPS',
    'common.request_failed': 'Сұрау сәтсіз аяқталды',
    'common.user': 'пайдаланушы',
    'common.unknown': 'беймәлім',

    'auth.skip_auth': 'Кіруді өткізу',
    'auth.create_account': 'Тіркелу',
    'auth.sign_in': 'Кіру',
    'auth.subtitle': '',
    'auth.nickname': 'Лақап ат',
    'auth.email': 'Эл. пошта',
    'auth.password': 'Құпиясөз',
    'auth.confirm_password': 'Құпиясөзді растау',
    'auth.login': 'Логин',
    'auth.placeholder.nickname': 'атыңыз',
    'auth.placeholder.email': 'mail@example.com',
    'auth.placeholder.password': 'Кемі 8 таңба',
    'auth.placeholder.confirm_password': 'Қайта енгізіңіз',
    'auth.placeholder.login': 'аты немесе пошта',
    'auth.placeholder.password_login': 'Құпиясөзіңіз',
    'auth.passwords_do_not_match': 'Құпиясөздер сәйкес емес',
    'auth.guest_mode_enabled': 'Қонақ режимі қосылды. Авторизация қажет эндпоинттар қолжетімсіз болуы мүмкін.',
    'auth.user_created': '{username} пайдаланушысы құрылды. Кіріңіз.',
    'auth.token_missing': 'Бэктен токен қайтпады',
    'auth.welcome': 'Қош келдіңіз, {username}',
    'auth.please_wait': 'Күте тұрыңыз...',
    'auth.sign_up_button': 'Тіркелу',
    'auth.sign_in_button': 'Кіру',
    'auth.already_have_account': 'Аккаунт бар ма? ',
    'auth.no_account_yet': 'Аккаунт жоқ па? ',
    'auth.create_one_link': 'Құру',

    'map.control_center': 'Басқару орталығы',
    'map.refresh_changes': 'Жаңарту',
    'map.logout': 'Шығу',
    'map.mapbox_token': 'Mapbox токені',
    'map.active': 'бар',
    'map.missing': 'жоқ',
    'map.congestion': 'Кептеліс',
    'map.hide_graph': 'Графикті жасыру',
    'map.show_graph': 'Графикті көрсету',
    'map.start_label': 'Бастау',
    'map.destination_label': 'Мақсат',
    'map.tap_map_a': 'картадан түрт (A)',
    'map.tap_map_b': 'картадан түрт (B)',
    'map.destination_set': 'орнатылды',
    'map.manual': 'қолмен',
    'map.use_my_location': 'Менің орным',
    'map.reset_ab': 'A/B тазалау',
    'map.route_info': 'Бағыт: {km} км · {min} мин',
    'map.mode_label': 'Режим',
    'map.route_mode_title': 'Ұсынылған маршрут түрі',
    'map.mode.driving': 'Көлік',
    'map.mode.walking': 'Жаяу',
    'map.mode.cycling': 'Велосипед',
    'map.min_short': 'м',
    'map.build_mode_on': 'Конструктор: қосулы',
    'map.build_mode_off': 'Конструктор: өшірулі',
    'map.build_type': 'Ғимарат түрі',
    'map.undo_building': 'Нысанды болдырмау',
    'map.clear_buildings': 'Нысандарды тазалау',
    'map.building.residential': 'Тұрғын үй',
    'map.building.office': 'Кеңсе',
    'map.building.school': 'Мектеп',
    'map.building.hospital': 'Аурухана',
    'map.building.park': 'Саябақ',
    'map.buildings_count': 'Картадағы нысандар: {count}',
    'map.buildings_impact':
      'Әсері: ағын {flow}, айналма {detour}%, экология {ecology}, әлеуметтік индекс {social}',
    'map.terrain_on': 'Рельеф: қосулы',
    'map.terrain_off': 'Рельеф: өшірулі',
    'map.heatmap_on': 'Heatmap: қосулы',
    'map.heatmap_off': 'Heatmap: өшірулі',
    'map.draw_start': 'Аймақ сызу',
    'map.draw_stop': 'Сызуды тоқтату',
    'map.isochrone_10m': 'Изохрона 10 мин',
    'map.loading_isochrone': 'Изохрона құрылуда...',
    'map.clear_isochrones': 'Изохронаны тазалау',
    'map.polygon_area': 'Аймақ ауданы',
    'map.polygon_population': 'Халық бағасы',
    'map.polygon_households': 'Үй шаруашылығы',
    'map.polygon_schools': 'Мектеп (бағалау)',
    'map.theme.dark': 'Қараңғы карта',
    'map.theme.light': 'Жарық карта',
    'map.legend_green': 'Жасыл: бос',
    'map.legend_yellow': 'Сары: орташа',
    'map.legend_red': 'Қызыл: кептеліс',
    'map.section.change_graph': 'Өзгеріс графигі',
    'map.metric.traffic': 'Көлік',
    'map.metric.ecology': 'Экология',
    'map.metric.social': 'Әлеумет',
    'map.flow': 'Ағын',
    'map.vehicles_per_hour': 'көлік/сағ',
    'map.detour': 'Айналма',
    'map.system_status': 'Жүйе күйі',
    'map.point.me_a': 'Мен (A)',
    'map.point.start_a': 'Бастау (A)',
    'map.point.destination_b': 'Мақсат (B)',
    'map.point.building': 'Нысан: {type}',

    'map.status.waiting_transport': 'Көлік жаңарту күтілуде',
    'map.status.change_graph_updated': 'Деректер жаңартылды',
    'map.status.transport_update_failed': 'Көлік дерегін жаңарту сәтсіз',
    'map.status.tap_to_set_a': 'Бастау нүктесін (A) қою үшін картадан түрт',
    'map.status.start_set_tap_b': 'Бастау (A) орнатылды. Мақсат (B) нүктесін картадан түрт.',
    'map.status.gps_a_set_tap_b': 'GPS бастау (A) орнатылды. Мақсат (B) нүктесін картадан түрт.',
    'map.status.location_denied': 'Геолокацияға рұқсат жоқ. Бастау (A) үшін картадан түрт.',
    'map.status.location_read_failed': 'GPS орнын оқу сәтсіз. Бастау (A) үшін картадан түрт.',
    'map.status.location_lookup_failed': 'Геолокация қатесі. Бастау (A) үшін картадан түрт.',
    'map.status.route_ready': 'Бағыт дайын',
    'map.status.route_ready_summary': 'Бағыт дайын: {summary}',
    'map.status.route_build_failed': 'Бағыт құру сәтсіз',
    'map.status.selecting_modes': 'Ағымдағы трафикке сай маршрут режимдері салыстырылуда...',
    'map.status.recommended_mode': 'Ұсынылған режим: {mode}.',
    'map.status.mode_pick_failed': 'Маршрут режимдерін таңдау сәтсіз.',
    'map.status.new_start_set': 'Жаңа A нүктесі қойылды. B нүктесін түртіңіз.',
    'map.status.build_mode_on': 'Құрылыс режимі қосылды. Картадан түртіп ғимарат қойыңыз.',
    'map.status.build_mode_off': 'Құрылыс режимі өшірілді.',
    'map.status.building_added': 'Нысан қосылды: {type}.',
    'map.status.building_removed': 'Соңғы нысан жойылды.',
    'map.status.buildings_cleared': 'Қосылған барлық нысандар жойылды.',
    'map.status.drawing_mode_active': 'Сызу режимі белсенді. Полигонды аяқтаңыз не режимді өшіріңіз.',
    'map.status.set_point_for_isochrone': 'Изохрона үшін алдымен картадан нүкте таңдаңыз.',
    'map.status.isochrone_ready': 'Изохрона дайын.',
    'map.status.isochrone_failed': 'Изохрона құру сәтсіз.',
    'map.status.isochrone_cleared': 'Изохроналар тазартылды.',
    'map.status.polygon_drawn': 'Полигон сызылды. Ауданы: {area} км².',
    'map.status.polygon_insights_ready': 'Аймақ аналитикасы дайын. Халық: ~{population}.',
    'map.status.polygon_cleared': 'Сызылған полигондар тазартылды.',

    'ai.agent': 'AI Агент',
    'ai.welcome':
      'Мен қала цифрлық егізінің AI агентімін. Мысалы сұра: "Алдағы сағаттарда трафик қалай өзгереді?"',
    'ai.placeholder': 'Мысалы: көпір жабылса трафик қалай өзгереді?',
    'ai.thinking': 'Ойлануда...',
    'ai.send': 'Жіберу',
    'ai.close': 'Жабу',

    'ai.fallback.bridge':
      'Болжам: ағын {flow} көлік/сағ, айналмада өсім шамамен {detour}%. Тәуекелдер: жергілікті кептеліс және жеткізу кешігуі. Әрекеттер: реверсивті қозғалыс, бағдаршамды қолмен реттеу, шарықтау кезде жүк көліктерін шектеу.',
    'ai.fallback.traffic':
      'Болжам: ағымдағы жүктеме шамамен {moving}%. Тәуекелдер: негізгі тораптарда жол уақыты ұзаруы мүмкін. Әрекеттер: сапарларды пік емес уақытқа ауыстыру, қоғамдық көлікке басымдық беру, циклдерді реттеу.',
    'ai.fallback.ecology':
      'Болжам: экология индексі шамамен {ecology}. Тәуекелдер: жүктемесі жоғары аймақтарда ауа сапасы нашарлауы мүмкін. Әрекеттер: тұрғын аудандар арқылы транзитті шектеу және ағындарды қайта бөлу.',
    'ai.fallback.default':
      'Ағымдағы деректер бойынша трафик, экология және логистика өзгерістерін бағалай аламын. Аудан/нысан және уақытты нақтыла.',
    'ai.fallback.buildings':
      'Жобада {count} жаңа нысан бар. Әсері: ағын {flow}, экология өзгерісі {ecology}. Дәл бағалау үшін құрылыс құрамы мен радиусты нақтылаңыз.',
    'ai.polygon_summary':
      'Аймақ талдауы: аудан {area} км², халық шамамен {population}, ұсынылатын мектеп саны: {schools}.',

    'map3d.traffic_ready': 'Mapbox кептеліс қабаты қосылды (жасыл/сары/қызғылт/қызыл).',
    'map3d.traffic_score': 'Mapbox кептеліс бағасы: {score}/10.',
    'map3d.mapbox_ready': 'Mapbox картасы қосылды.',
    'map3d.terrain_ready': 'Mapbox 3D рельефі қосылды.',
    'map3d.isochrone_ready': 'Изохроналар картада көрсетілді.',
    'map3d.draw_mode_on': 'Сызу режимі қосылды.',
    'map3d.draw_mode_off': 'Сызу режимі өшірілді.',
    'map3d.draw_complete': 'Полигон аяқталды.',
    'map3d.draw_cleared': 'Полигон тазартылды.',
    'map3d.fallback_ready': 'Қосалқы карта қосылды (MapLibre).',
  },
};

function format(template, params) {
  if (!params) return template;
  return String(template).replace(/\{(\w+)\}/g, (_, key) => {
    const value = params[key];
    return value === undefined || value === null ? '' : String(value);
  });
}

const I18nContext = createContext({
  lang: 'ru',
  setLang: () => undefined,
  t: (key) => key,
});

export function I18nProvider({ children, initialLang = 'ru' }) {
  const [lang, setLang] = useState(initialLang);

  const t = useCallback(
    (key, params) => {
      const dict = translations[lang] || translations.ru;
      const fallback = translations.ru;
      const value = dict[key] ?? fallback[key] ?? translations.en[key] ?? key;
      return format(value, params);
    },
    [lang]
  );

  const value = useMemo(() => ({ lang, setLang, t }), [lang, t]);
  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  return useContext(I18nContext);
}
